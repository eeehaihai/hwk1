<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吉大树洞 - 用户注册</title>
    <link rel="stylesheet" href="style.css">
    <!-- 引入验证脚本 -->
    <script src="register.js"></script>
</head>
<body>
    <div class="page-container">
        <h1>吉大树洞 - 用户注册</h1>
        <form id="registerForm" onsubmit="return false;">
            <!-- 基本信息 -->
            <fieldset>
                <legend>基本信息</legend>
                <div class="form-group">
                    <label for="username" class="required">用户名</label>
                    <input type="text" id="username" name="username" required placeholder="请输入5-20位字母、数字或下划线" pattern="[a-zA-Z0-9_]{5,20}" oninput="validateUsername()">
                    <span id="username_message" style="color: red; font-size: 14px;"></span>
                </div>
                
                <div class="form-group">
                    <label for="password" class="required">密码</label>
                    <input type="password" id="password" name="password" required placeholder="请设置8位以上密码" minlength="8" oninput="checkPasswordMatch();">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password" class="required">确认密码</label>
                    <input type="password" id="confirm_password" name="confirm_password" required placeholder="请再次输入密码" minlength="8" oninput="checkPasswordMatch();">
                    <span id="password_match_message" style="color: red; font-size: 14px;"></span>
                </div>

                <div class="form-group">
                    <label for="email" class="required">电子邮箱</label>
                    <input type="email" id="email" name="email" required placeholder="请输入有效的电子邮箱" oninput="validateEmail()">
                    <span id="email_message" style="color: red; font-size: 14px;"></span>
                </div>
                
                <div class="form-group">
                    <label for="phone" class="required">手机号码</label>
                    <input type="tel" id="phone" name="phone" required placeholder="请输入11位手机号码" pattern="[0-9]{11}" oninput="validatePhone()">
                    <span id="phone_message" style="color: red; font-size: 14px;"></span>
                </div>
            </fieldset>
            
            <!-- 个人资料 -->
            <fieldset>
                <legend>个人资料</legend>
                <div class="form-group">
                    <label for="real_name">真实姓名</label>
                    <input type="text" id="real_name" name="real_name" placeholder="请输入真实姓名">
                </div>
                
                <div class="form-group">
                    <label for="nickname" class="required">昵称</label>
                    <input type="text" id="nickname" name="nickname" required placeholder="请输入您的昵称">
                </div>
                
                <div class="form-group">
                    <label>性别</label>
                    <div class="radio-group">
                        <div class="radio-button">
                            <input type="radio" id="gender_male" name="gender" value="male" checked>
                            <label for="gender_male" class="radio-label">男</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="gender_female" name="gender" value="female">
                            <label for="gender_female" class="radio-label">女</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="birth_date">出生日期</label>
                    <input type="date" id="birth_date" name="birth_date">
                </div>
                
                <div class="form-group">
                    <label for="student_id">学号</label>
                    <input type="text" id="student_id" name="student_id" placeholder="请输入您的学号">
                </div>
                
                <div class="form-group">
                    <label for="college">学院</label>
                    <select id="college" name="college">
                        <option value="">请选择学院</option>
                        <option value="cs">计算机科学与技术学院</option>
                        <option value="math">数学学院</option>
                        <option value="physics">物理学院</option>
                        <option value="chemistry">化学学院</option>
                        <option value="life">生命科学学院</option>
                        <option value="law">法学院</option>
                        <option value="economics">经济学院</option>
                        <option value="management">管理学院</option>
                        <option value="arts">文学院</option>
                        <option value="foreign">外国语学院</option>
                        <option value="other">其他学院</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="major">专业</label>
                    <input type="text" id="major" name="major" placeholder="请输入您的专业">
                </div>
                
                <div class="form-group">
                    <label for="grade">年级</label>
                    <select id="grade" name="grade">
                        <option value="">请选择年级</option>
                        <option value="freshman">大一</option>
                        <option value="sophomore">大二</option>
                        <option value="junior">大三</option>
                        <option value="senior">大四</option>
                        <option value="master1">硕士一年级</option>
                        <option value="master2">硕士二年级</option>
                        <option value="master3">硕士三年级</option>
                        <option value="phd">博士</option>
                        <option value="other">其他</option>
                    </select>
                </div>
            </fieldset>
            
            <!-- 兴趣爱好 -->
            <fieldset>
                <legend>兴趣爱好</legend>
                <div class="form-group">
                    <label>兴趣分类</label>
                    <div class="radio-group">
                        <div class="radio-button">
                            <input type="radio" id="interest_tech" name="interests" value="tech">
                            <label for="interest_tech" class="radio-label">科技</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_sports" name="interests" value="sports">
                            <label for="interest_sports" class="radio-label">体育</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_music" name="interests" value="music">
                            <label for="interest_music" class="radio-label">音乐</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_movie" name="interests" value="movie">
                            <label for="interest_movie" class="radio-label">电影</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_reading" name="interests" value="reading">
                            <label for="interest_reading" class="radio-label">阅读</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_travel" name="interests" value="travel">
                            <label for="interest_travel" class="radio-label">旅行</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_food" name="interests" value="food">
                            <label for="interest_food" class="radio-label">美食</label>
                        </div>
                        <div class="radio-button">
                            <input type="radio" id="interest_game" name="interests" value="game">
                            <label for="interest_game" class="radio-label">游戏</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bio">个人简介</label>
                    <textarea id="bio" name="bio" rows="4" placeholder="请简单介绍一下自己（选填）"></textarea>
                </div>
            </fieldset>
            
            <fieldset>
                <legend>隐私设置</legend>
                <div class="checkbox-group">
                    <input type="checkbox" id="show_email" name="privacy_settings" value="show_email">
                    <label for="show_email">公开我的邮箱</label>
                </div>
                <div class="checkbox-group">    
                    <input type="checkbox" id="show_profile" name="privacy_settings" value="show_profile">
                    <label for="show_profile">公开我的个人资料</label>
                </div>
                <div class="checkbox-group">    
                    <input type="checkbox" id="allow_message" name="privacy_settings" value="allow_message" checked>
                    <label for="allow_message">允许他人给我发送私信</label>
                </div>
            </fieldset>
            
            <!-- 协议同意 -->
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="agree_terms" name="agree_terms" required>
                    <label for="agree_terms" class="required">我已阅读并同意<a href="#" target="_blank">《吉大树洞用户协议》</a>和<a href="#" target="_blank">《隐私政策》</a></label>
                </div>
            </div>
            
            <div id="registerMessage" class="message-box" style="display: none;"></div>
            
            <button type="submit" class="register-button" id="submitBtn" onclick="submitRegistration()">注册账号</button>
            
            <div class="form-footer">
                已有账号？<a href="login.html">立即登录</a>
            </div>
        </form>
    </div>
    
    <script>
        // 提交注册
        function submitRegistration() {
            // 执行表单验证
            if(!validateForm()) {
                return;
            }
            
            // 获取主要表单数据
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const nickname = document.getElementById('nickname').value;
            
            const messageBox = document.getElementById('registerMessage');
            
            // 清除之前的消息
            messageBox.style.display = 'none';
            messageBox.innerHTML = '';
            messageBox.className = 'message-box';
            
            // 创建FormData对象
            const formData = new FormData();
            formData.append('username', username);
            formData.append('password', password);
            formData.append('email', email);
            formData.append('phone', phone);
            formData.append('nickname', nickname);
            
            // 使用AJAX发送请求到PHP处理文件
            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'register.php', true);
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        const response = JSON.parse(xhr.responseText);
                        
                        if (response.success) {
                            // 注册成功
                            messageBox.innerHTML = '注册成功，正在跳转到登录页...';
                            messageBox.className = 'message-box success';
                            messageBox.style.display = 'block';
                            
                            // 延迟跳转到登录页
                            setTimeout(function() {
                                window.location.href = 'login.html';
                            }, 2000);
                        } else {
                            // 注册失败
                            messageBox.innerHTML = response.message || '注册失败，请检查表单并重试！';
                            messageBox.className = 'message-box error';
                            messageBox.style.display = 'block';
                        }
                    } catch (e) {
                        // JSON解析错误
                        messageBox.innerHTML = '服务器响应格式错误，请稍后再试！';
                        messageBox.className = 'message-box error';
                        messageBox.style.display = 'block';
                        console.error('JSON解析错误:', e);
                    }
                } else {
                    // HTTP错误
                    messageBox.innerHTML = '服务器连接错误，请稍后再试！';
                    messageBox.className = 'message-box error';
                    messageBox.style.display = 'block';
                    console.error('HTTP错误:', xhr.status);
                }
            };
            
            xhr.onerror = function() {
                messageBox.innerHTML = '网络错误，请检查您的连接！';
                messageBox.className = 'message-box error';
                messageBox.style.display = 'block';
                console.error('网络错误');
            };
            
            xhr.send(formData);
        }
    </script>
</body>
</html>