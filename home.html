<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§æ ‘æ´ - é¦–é¡µ</title>
    <link rel="stylesheet" href="style.css">
    <script src="common.js"></script>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header>
        <div class="container header-content">
            <a href="home.html" class="logo">
                <h1>å‰å¤§æ ‘æ´</h1>
            </a>
            
            <div class="user-actions">
                <!-- è¿™é‡Œä¼šé€šè¿‡JSåŠ¨æ€æ›´æ–°ç”¨æˆ·ç™»å½•çŠ¶æ€ -->
            </div>
        </div>
    </header>
    
    <!-- æœç´¢åŒºåŸŸ -->
    <section class="search-section">
        <div class="container search-container">
            <h2>æ¢ç´¢æ ¡å›­é‡Œçš„å¥‡é—»è¶£äº‹ä¸ç”Ÿæ´»ç‚¹æ»´</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢è¯é¢˜ã€å…³é”®è¯...">
                <button onclick="searchPosts()" class="search-icon-btn">ğŸ”</button>
            </div>
        </div>
    </section>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="container main-content">
        <!-- è¯é¢˜åˆ—è¡¨åŒºåŸŸ -->
        <div class="topic-list">
            <a href="create-topic.html" class="create-topic-btn">å‘å¸ƒæ–°è¯é¢˜</a>
            
            <div class="topic-filter">
                <div class="filter-options">
                    <a href="#" class="active" data-category="all">å…¨éƒ¨</a>
                    <a href="#" data-category="campus_life">æ ¡å›­ç”Ÿæ´»</a>
                    <a href="#" data-category="study">å­¦ä¹ äº¤æµ</a>
                    <a href="#" data-category="secondhand">äºŒæ‰‹äº¤æ˜“</a>
                    <a href="#" data-category="lost_found">å¤±ç‰©æ‹›é¢†</a>
                </div>
                <div class="sort-options">
                    <a href="#" class="active" data-sort="newest">æœ€æ–°</a>
                    <div class="sort-option-group">
                        <a href="#" data-sort="hottest" id="hottestSortLink">çƒ­é—¨</a>
                        <div class="hottest-tooltip" id="hottestTooltip">
                            <a href="#" data-timerange="1w">ä¸€æ˜ŸæœŸ <span class="checkmark"></span></a>
                            <a href="#" data-timerange="1m">ä¸€ä¸ªæœˆ <span class="checkmark"></span></a>
                            <a href="#" data-timerange="6m">åŠå¹´å†… <span class="checkmark"></span></a>
                            <a href="#" data-timerange="1y">ä¸€å¹´å†… <span class="checkmark"></span></a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¯é¢˜åˆ—è¡¨ -->
            <div id="topicListContainer">
                <!-- è¿™é‡Œå°†é€šè¿‡JSåŠ¨æ€åŠ è½½è¯é¢˜åˆ—è¡¨ -->
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- ä¾§è¾¹æ åŒºåŸŸ -->
        <div class="sidebar">
            <!-- çƒ­é—¨åˆ†ç±» -->
            <div class="sidebar-widget">
                <h3>çƒ­é—¨åˆ†ç±»</h3>
                <ul class="category-list" id="categoryCounts">
                    <!-- è¿™é‡Œå°†é€šè¿‡JSåŠ¨æ€åŠ è½½åˆ†ç±»è®¡æ•° -->
                </ul>
            </div>
            
            <!-- çƒ­é—¨è¯é¢˜ -->
            <div class="sidebar-widget">
                <h3>çƒ­é—¨è¯é¢˜</h3>
                <ul class="hot-topics" id="hotTopics">
                    <!-- è¿™é‡Œå°†é€šè¿‡JSåŠ¨æ€åŠ è½½çƒ­é—¨è¯é¢˜ -->
                </ul>
            </div>
            
            <!-- ç”¨æˆ·æ’è¡Œ -->
            <div class="sidebar-widget">
                <h3>æ´»è·ƒç”¨æˆ·æ¦œ</h3>
                <ul class="category-list" id="activeUsers">
                    <!-- è¿™é‡Œå°†é€šè¿‡JSåŠ¨æ€åŠ è½½æ´»è·ƒç”¨æˆ· -->
                </ul>
            </div>
        </div>
    </div>
    
    <!-- é¡µè„šåŒºåŸŸ -->
    <footer>
        <div class="container footer-content">
            <div class="footer-links">
                <div>
                    <h4>å‹æƒ…é“¾æ¥</h4>
                    <ul>
                        <li><a href="https://www.jlu.edu.cn/" target="_blank">å‰æ—å¤§å­¦å®˜ç½‘</a></li>
                        <li><a href="https://jdjyw.jlu.edu.cn/">å‰å¤§å°±ä¸šç½‘</a></li>
                        <li><a href="http://lib.jlu.edu.cn">å‰å¤§å›¾ä¹¦é¦†</a></li>
                        <li><a href="https://ehall.jlu.edu.cn/">ç½‘ä¸ŠåŠäº‹å¤§å…</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            <div class="container">
                Copyright &copy; 2025 å‰å¤§æ ‘æ´ All Rights Reserved. å‰ICPå¤‡XXXXXXXXå·
            </div>
        </div>
    </footer>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // æ›´æ–°å¯¼èˆªæ ç”¨æˆ·çŠ¶æ€
            updateNavUserStatus();
            
            // åŠ è½½å¹¶æ˜¾ç¤ºè¯é¢˜åˆ—è¡¨ (é»˜è®¤æ’åºå’Œåˆ†ç±»)
            loadTopics(); 
            
            // è·å–æ‰€æœ‰å¸–å­æ•°æ®ä¸€æ¬¡ï¼Œç„¶åä¼ é€’ç»™ä¾§è¾¹æ æ›´æ–°å‡½æ•°
            getAllPosts(function(allPostsData) {
                if (allPostsData && allPostsData.length > 0) {
                    updateCategoryCounts(allPostsData);
                    loadHotTopics(allPostsData);
                    loadActiveUsers(allPostsData);
                } else {
                    // å¤„ç†è·å–æ•°æ®å¤±è´¥æˆ–æ— æ•°æ®çš„æƒ…å†µ
                    document.getElementById('categoryCounts').innerHTML = '<li>æ— æ³•åŠ è½½åˆ†ç±»</li>';
                    document.getElementById('hotTopics').innerHTML = '<li>æ— æ³•åŠ è½½çƒ­é—¨è¯é¢˜</li>';
                    document.getElementById('activeUsers').innerHTML = '<li>æ— æ³•åŠ è½½æ´»è·ƒç”¨æˆ·</li>';
                }
            });

            // æ¢å¤æ»šåŠ¨ä½ç½®
            const scrollPosition = sessionStorage.getItem('homeScrollPosition');
            if (scrollPosition) {
                window.scrollTo(0, parseInt(scrollPosition, 10));
                sessionStorage.removeItem('homeScrollPosition'); // ä½¿ç”¨åæ¸…é™¤
            }
            
            // è®¾ç½®åˆ†ç±»ç­›é€‰ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.filter-options a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ç§»é™¤ä¹‹å‰çš„activeç±»
                    document.querySelectorAll('.filter-options a').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰ç‚¹å‡»é¡¹
                    this.classList.add('active');
                    
                    // æ ¹æ®åˆ†ç±»ç­›é€‰è¯é¢˜
                    const category = this.getAttribute('data-category');
                    loadTopics(category);
                });
            });
            
            // è®¾ç½®æ’åºç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.sort-options a[data-sort]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const currentSortBy = this.getAttribute('data-sort');
                    const currentCategory = document.querySelector('.filter-options a.active').getAttribute('data-category');

                    if (currentSortBy === 'hottest') {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯çƒ­é—¨ä¸»æŒ‰é’®ï¼Œé»˜è®¤ä½¿ç”¨ä¸Šæ¬¡é€‰æ‹©æˆ–â€œä¸€æ˜ŸæœŸâ€
                        const activeTimeRangeLink = document.querySelector('.hottest-tooltip a.selected');
                        const timeRange = activeTimeRangeLink ? activeTimeRangeLink.getAttribute('data-timerange') : '1w';
                        
                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        if (!activeTimeRangeLink) { // é»˜è®¤é€‰ä¸­â€œä¸€æ˜ŸæœŸâ€
                             const defaultTimeRangeLink = document.querySelector('.hottest-tooltip a[data-timerange="1w"]');
                             if (defaultTimeRangeLink) {
                                 document.querySelectorAll('.hottest-tooltip a .checkmark').forEach(cm => cm.textContent = '');
                                 defaultTimeRangeLink.querySelector('.checkmark').textContent = 'âˆš';
                                 defaultTimeRangeLink.classList.add('selected');
                             }
                        }
                        loadTopics(currentCategory, currentSortBy, timeRange);
                    } else {
                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active');
                        // æ¸…é™¤çƒ­é—¨æ—¶é—´èŒƒå›´é€‰æ‹©
                        document.querySelectorAll('.hottest-tooltip a').forEach(item => {
                            item.classList.remove('selected');
                            item.querySelector('.checkmark').textContent = '';
                        });
                        loadTopics(currentCategory, currentSortBy);
                    }
                });
            });

            // çƒ­é—¨ç­›é€‰æ‚¬æµ®çª—é€»è¾‘
            const hottestSortLink = document.getElementById('hottestSortLink');
            const hottestTooltip = document.getElementById('hottestTooltip');
            let tooltipTimeout;

            if (hottestSortLink && hottestTooltip) {
                hottestSortLink.addEventListener('mouseenter', () => {
                    clearTimeout(tooltipTimeout);
                    hottestTooltip.style.display = 'block';
                });

                hottestSortLink.addEventListener('mouseleave', () => {
                    tooltipTimeout = setTimeout(() => {
                        hottestTooltip.style.display = 'none';
                    }, 200);
                });

                hottestTooltip.addEventListener('mouseenter', () => {
                    clearTimeout(tooltipTimeout);
                });

                hottestTooltip.addEventListener('mouseleave', () => {
                    tooltipTimeout = setTimeout(() => {
                        hottestTooltip.style.display = 'none';
                    }, 200);
                });

                hottestTooltip.querySelectorAll('a').forEach(timeRangeLink => {
                    timeRangeLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation(); // é˜»æ­¢å†’æ³¡åˆ°çˆ¶çº§ a æ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶

                        const timeRange = this.getAttribute('data-timerange');
                        const category = document.querySelector('.filter-options a.active').getAttribute('data-category');
                        
                        // æ›´æ–°æ’åºé€‰é¡¹çš„ active çŠ¶æ€
                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        hottestSortLink.classList.add('active');

                        // æ›´æ–°æ‚¬æµ®çª—å†…é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€å’Œâˆšæ ‡è®°
                        hottestTooltip.querySelectorAll('a').forEach(item => {
                            item.classList.remove('selected');
                            item.querySelector('.checkmark').textContent = '';
                        });
                        this.classList.add('selected');
                        this.querySelector('.checkmark').textContent = 'âˆš';
                        
                        loadTopics(category, 'hottest', timeRange);
                        hottestTooltip.style.display = 'none'; // ç‚¹å‡»åéšè—æ‚¬æµ®çª—
                    });
                });
            }
        });
        
        // æŸ¥çœ‹è¯é¢˜è¯¦æƒ…
        function viewTopic(id) {
            sessionStorage.setItem('homeScrollPosition', window.scrollY); // ä¿å­˜æ»šåŠ¨ä½ç½®
            window.location.href = `topic-detail.html?id=${id}`;
        }
        
        // è¯é¢˜å¡ç‰‡åˆ›å»ºå‡½æ•°
        function createTopicCard(post) {
            const topicCard = document.createElement('div');
            topicCard.className = 'topic-card';
            
            // ä½¿ç”¨é€šç”¨å‡½æ•°æˆªæ–­é•¿æ–‡æœ¬
            const contentPreview = truncateText(post.content);
            
            // ä½¿ç”¨é€šç”¨å‡½æ•°å¤„ç†HTMLå®‰å…¨
            topicCard.innerHTML = `
                <div class="topic-header">
                    <h3 class="topic-title">${safeHtml(post.title)}</h3>
                    <span class="topic-category">${safeHtml(post.categoryName)}</span>
                </div>
                <div class="topic-meta">
                    <span class="topic-author">${safeHtml(post.author)}</span>
                    <span class="topic-time">${formatTime(post.timestamp)}</span>
                    <span class="topic-views">æµè§ˆ ${post.views}</span>
                </div>
                <div class="topic-content">${safeHtml(contentPreview)}</div>
                <div class="topic-footer">
                    <div class="topic-stats">
                        <span class="like-btn" onclick="likeTopicInList('${post.id}', event)">
                            <span class="like-icon">â¤</span> ç‚¹èµ <span class="like-count">${post.likes || 0}</span>
                        </span>
                        <span>è¯„è®º ${post.comments || 0}</span>
                    </div>
                    <div class="topic-action">
                        <a href="#" onclick="event.preventDefault(); event.stopPropagation(); viewTopic('${post.id}');">å‚ä¸è®¨è®º</a>
                    </div>
                </div>
            `;
            
            // å¢åŠ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½
            topicCard.addEventListener('click', function(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯ç‚¹èµæŒ‰é’®ï¼Œä¸è¦è·³è½¬
                if (e.target.closest('.like-btn')) {
                    return;
                }
                viewTopic(post.id);
            });
            
            return topicCard;
        }
        
        // åŠ è½½è¯é¢˜åˆ—è¡¨
        function loadTopics(category = 'all', sortBy = 'newest', timeRange = null) {
            const topicListContainer = document.getElementById('topicListContainer');
            topicListContainer.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            let apiUrl = `topics.php?category=${category}&sortBy=${sortBy}`;
            if (sortBy === 'hottest' && timeRange) {
                apiUrl += `&timeRange=${timeRange}`;
            }
            
            // ä½¿ç”¨é€šç”¨AJAXè¯·æ±‚å‡½æ•°
            sendAjaxRequest('GET', apiUrl, null, 
                function(response) {
                    if (response.success) {
                        const posts = response.topics;
                        
                        // å¦‚æœæ²¡æœ‰å¸–å­ï¼Œæ˜¾ç¤ºæç¤º
                        if (posts.length === 0) {
                            topicListContainer.innerHTML = '<div class="no-topics">æš‚æ— è¯é¢˜ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªè¯é¢˜å§ï¼</div>';
                            return;
                        }
                        
                        // æ¸…ç©ºåŠ è½½æç¤º
                        topicListContainer.innerHTML = '';
                        
                        // æ˜¾ç¤ºæ¯ä¸ªå¸–å­
                        posts.forEach(post => {
                            const topicCard = createTopicCard(post);
                            topicListContainer.appendChild(topicCard);
                        });
                    } else {
                        topicListContainer.innerHTML = `<div class="no-topics">åŠ è½½è¯é¢˜å¤±è´¥: ${safeHtml(response.message)}</div>`;
                    }
                },
                function() {
                    topicListContainer.innerHTML = '<div class="no-topics">æœåŠ¡å™¨è¿æ¥é”™è¯¯ï¼Œè¯·ç¨åå†è¯•</div>';
                }
            );
        }
        
        // åœ¨åˆ—è¡¨é¡µç‚¹èµè¯é¢˜
        function likeTopicInList(topicId, event) {
            event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘è¯é¢˜å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶
            
            const likeBtn = event.currentTarget;
            const likeCountEl = likeBtn.querySelector('.like-count');
            
            // ä½¿ç”¨é€šç”¨AJAXè¯·æ±‚å‡½æ•°
            sendAjaxRequest('POST', 'like_topic.php', { topicId: topicId },
                function(response) {
                    if (response.success) {
                        // æ›´æ–°æ˜¾ç¤ºçš„ç‚¹èµæ•°
                        likeCountEl.textContent = response.likes;
                    } else {
                        console.error('ç‚¹èµå¤±è´¥:', response.message);
                        alert(response.message || 'ç‚¹èµå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                    }
                },
                function() {
                    console.error('ç‚¹èµè¯·æ±‚å¤±è´¥');
                }
            );
        }
        
        // æ›´æ–°åˆ†ç±»ç»Ÿè®¡
        function updateCategoryCounts(posts) { // æ¥æ”¶ posts æ•°æ®ä½œä¸ºå‚æ•°
            const categoryCountsEl = document.getElementById('categoryCounts');
            // ç¡®ä¿åœ¨åŠ è½½çƒ­é—¨è¯é¢˜ä¹‹å‰ï¼Œé»˜è®¤é€‰ä¸­â€œä¸€æ˜ŸæœŸâ€
            const defaultTimeRangeLink = document.querySelector('.hottest-tooltip a[data-timerange="1w"]');
            if (defaultTimeRangeLink && !document.querySelector('.hottest-tooltip a.selected')) {
                defaultTimeRangeLink.classList.add('selected');
                defaultTimeRangeLink.querySelector('.checkmark').textContent = 'âˆš';
            }
            
            categoryCountsEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨
            
            // ç»Ÿè®¡æ¯ä¸ªåˆ†ç±»çš„æ•°é‡
            const categoryCounts = {
                'campus_life': 0,
                'study': 0,
                'secondhand': 0,
                'lost_found': 0
            };
            
            posts.forEach(post => {
                if (categoryCounts.hasOwnProperty(post.category)) {
                    categoryCounts[post.category]++;
                }
            });
            
            // æ˜¾ç¤ºåˆ†ç±»ç»Ÿè®¡
            const categoryNames = {
                'campus_life': 'æ ¡å›­ç”Ÿæ´»',
                'study': 'å­¦ä¹ äº¤æµ',
                'secondhand': 'äºŒæ‰‹äº¤æ˜“',
                'lost_found': 'å¤±ç‰©æ‹›é¢†'
            };
            
            for (const category in categoryNames) { // Iterate over categoryNames to maintain order and selection
                if (categoryNames.hasOwnProperty(category)) {
                    const count = categoryCounts[category] || 0;
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="#" data-category="${category}">${categoryNames[category]} <span class="category-count">${count}</span></a>`;
                    
                    li.querySelector('a').addEventListener('click', function(e) {
                        e.preventDefault();
                        document.querySelectorAll('.filter-options a').forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('data-category') === category) {
                                link.classList.add('active');
                            }
                        });
                        loadTopics(category);
                    });
                    categoryCountsEl.appendChild(li);
                }
            }
        }
        
        // åŠ è½½çƒ­é—¨è¯é¢˜
        function loadHotTopics(posts) { // æ¥æ”¶ posts æ•°æ®ä½œä¸ºå‚æ•°
            const hotTopicsEl = document.getElementById('hotTopics');
            
            hotTopicsEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨
            
            // æŒ‰çƒ­åº¦æ’åºï¼ˆæµè§ˆé‡+ç‚¹èµæ•°*2ï¼‰
            const sortedPosts = [...posts].sort((a, b) => (b.views + (b.likes || 0) * 2) - (a.views + (a.likes || 0) * 2));
            
            // åªæ˜¾ç¤ºå‰5ä¸ªçƒ­é—¨è¯é¢˜
            const topPosts = sortedPosts.slice(0, 5);
            
            if (topPosts.length === 0) {
                hotTopicsEl.innerHTML = '<li>æš‚æ— çƒ­é—¨è¯é¢˜</li>';
                return;
            }
            
            topPosts.forEach(post => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#">${safeHtml(post.title)}</a>`;
                li.querySelector('a').addEventListener('click', function(e) {
                    e.preventDefault();
                    viewTopic(post.id);
                });
                hotTopicsEl.appendChild(li);
            });
        }
        
        // åŠ è½½æ´»è·ƒç”¨æˆ·
        function loadActiveUsers(posts) { // æ¥æ”¶ posts æ•°æ®ä½œä¸ºå‚æ•°
            const activeUsersEl = document.getElementById('activeUsers');
            
            activeUsersEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨
            
            const userPostCounts = {};
            posts.forEach(post => {
                if (post.author && post.author !== 'åŒ¿åç”¨æˆ·') {
                    userPostCounts[post.author] = (userPostCounts[post.author] || 0) + 1;
                }
            });
            
            const users = Object.keys(userPostCounts).map(user => ({
                username: user,
                postCount: userPostCounts[user]
            })).sort((a, b) => b.postCount - a.postCount);
            
            const topUsers = users.slice(0, 5);
            
            if (topUsers.length === 0) {
                activeUsersEl.innerHTML = '<li>æš‚æ— æ´»è·ƒç”¨æˆ·</li>';
                return;
            }
            
            topUsers.forEach(user => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#">${safeHtml(user.username)} <span class="category-count">${user.postCount}</span></a>`;
                // å¯é€‰ï¼šä¸ºæ´»è·ƒç”¨æˆ·æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œä¾‹å¦‚è·³è½¬åˆ°ç”¨æˆ·ä¸»é¡µï¼ˆå¦‚æœæœªæ¥æœ‰æ­¤åŠŸèƒ½ï¼‰
                activeUsersEl.appendChild(li);
            });
        }
        
        // æœç´¢å¸–å­
        function searchPosts() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!searchTerm) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            const topicListContainer = document.getElementById('topicListContainer');
            topicListContainer.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';
            
            getAllPosts(function(posts) {
                // æ ¹æ®å…³é”®è¯æœç´¢å¸–å­ï¼ˆæ ‡é¢˜å’Œå†…å®¹ï¼‰
                const filteredPosts = posts.filter(post => 
                    post.title.toLowerCase().includes(searchTerm) || 
                    post.content.toLowerCase().includes(searchTerm) ||
                    (post.tags && post.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
                
                // æ˜¾ç¤ºæœç´¢ç»“æœ
                if (filteredPosts.length === 0) {
                    topicListContainer.innerHTML = `<div class="no-topics">æ²¡æœ‰æ‰¾åˆ°ä¸ "${safeHtml(searchTerm)}" ç›¸å…³çš„è¯é¢˜</div>`;
                    return;
                }
                
                // æ¸…ç©ºç°æœ‰å†…å®¹
                topicListContainer.innerHTML = `<div class="search-result-info">æ‰¾åˆ° ${filteredPosts.length} ä¸ªä¸ "${safeHtml(searchTerm)}" ç›¸å…³çš„è¯é¢˜</div>`;
                
                // æ˜¾ç¤ºæ¯ä¸ªå¸–å­
                filteredPosts.forEach(post => {
                    const topicCard = createTopicCard(post);
                    topicListContainer.appendChild(topicCard);
                });
            });
        }
    </script>

    <style>
        /* ç‚¹èµæŒ‰é’®æ ·å¼ */
        .like-btn {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            color: #666;
            transition: color 0.3s;
        }

        .like-btn:hover {
            color: #e74c3c;
        }

        .like-icon {
            margin-right: 5px;
            font-size: 14px;
        }

        /* çƒ­é—¨ç­›é€‰æ‚¬æµ®çª—æ ·å¼ */
        .hottest-tooltip {
            display: none;
            position: absolute;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            z-index: 1000;
            width: 150px;
        }

        .hottest-tooltip a {
            display: block;
            padding: 8px;
            color: #333;
            text-decoration: none;
            position: relative;
        }

        .hottest-tooltip a:hover {
            background: #f5f5f5;
        }

        .hottest-tooltip .checkmark {
            position: absolute;
            right: 10px;
            top: 8px;
            color: #e74c3c;
            font-weight: bold;
            display: none;
        }

        .hottest-tooltip a.selected .checkmark {
            display: inline;
        }
    </style>
</body>
</html>
